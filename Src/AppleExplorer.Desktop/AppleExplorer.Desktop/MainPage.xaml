<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" 
             xmlns:viewmodeles="clr-namespace:AppleExplorer.Desktop.ViewModeles"
             xmlns:conv="clr-namespace:AppleExplorer.Desktop.Converters" 
             x:DataType="viewmodeles:MainPageViewModel"
             x:Class="AppleExplorer.Desktop.MainPage">

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:ExpandCollapseConverter x:Key="ExpandCollapseConverter" />
            <conv:LevelToPaddingConverter x:Key="LevelToPaddingConverter" />
            <conv:VisibilityTextConverter x:Key="VisibilityTextConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <!-- 3-row layout: Button (Auto), Header (Auto), Scrollable table (*) -->
    <Grid RowDefinitions="Auto,Auto,*" ColumnDefinitions="*">

        <!-- Row 0: Fixed top controls -->
        <StackLayout Grid.Row="0"
                     Orientation="Horizontal"
                     Padding="10"
                     Spacing="10"
                     HorizontalOptions="Start">
            <Button
                x:Name="CounterBtn"
                Text="Click me" 
                SemanticProperties.Hint="Counts the number of times you click"
                Clicked="OnCounterClicked" />
        </StackLayout>

        <!-- Row 1: Fixed header -->
        <Grid Grid.Row="1"
              BackgroundColor="#EEE"
              Padding="5">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <Label Grid.Column="0" Text="Expand" FontAttributes="Bold" />
                <Label Grid.Column="1" Text="Title" FontAttributes="Bold" />
                <Label Grid.Column="2" Text="Visible" FontAttributes="Bold" HorizontalTextAlignment="Center" />
            </Grid>
        </Grid>

        <!-- Row 2: Scrollable table -->
        <CollectionView Grid.Row="2"
                        ItemsSource="{Binding AllNodes}"
                        SelectionMode="None"
                        HorizontalOptions="Fill"
                        VerticalOptions="Start">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="viewmodeles:NodeViewModel">
                    <!-- Row grid: columns match header and row fills available width -->
                    <Grid ColumnDefinitions="Auto,*,Auto"
                          IsVisible="{Binding IsVisible}"
                          HorizontalOptions="Fill"
                          VerticalOptions="Center"
                          Padding="4,6">
                        <!-- Expand/Collapse Icon (left column) -->
                        <Label Grid.Column="0" 
                               Padding="{Binding Level, Converter={StaticResource LevelToPaddingConverter}}" 
                               VerticalTextAlignment="Center" 
                               HorizontalOptions="Start">
                            <Label.Text>
                                <MultiBinding Converter="{StaticResource ExpandCollapseConverter}">
                                    <Binding Path="IsExpanded" />
                                    <Binding Path="." />
                                </MultiBinding>
                            </Label.Text>
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ToggleExpandCommand}" />
                            </Label.GestureRecognizers>
                        </Label>

                        <!-- Title (middle column) — fill middle column and align left -->
                        <Grid Grid.Column="1">
                            <Label Text="{Binding Title}"
                                   VerticalTextAlignment="Center"
                                   HorizontalTextAlignment="Start"
                                   HorizontalOptions="Start" />
                        </Grid>

                        <!-- Visibility Status (right column) -->
                        <Label Grid.Column="2"
                               Text="{Binding IsVisible, Converter={StaticResource VisibilityTextConverter}}"
                               HorizontalTextAlignment="Center"
                               VerticalTextAlignment="Center"
                               HorizontalOptions="End" />
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </Grid>

</ContentPage>